<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="./metronic/assets/global/plugins/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <link href="./metronic/assets/global/plugins/bootstrap/css/bootstrap.css" rel="stylesheet"/>
    <link href="./metronic/assets/global/css/components.css" rel="stylesheet"/>
    <style>
        .errorMessage{
            color: #FF0000;
        }
        .deleteAll{
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(211, 211, 211, 0.42);
            display: none;
        }
        .delete{
            width: 200px;
            height:150px;
            position: relative;
            left: 50%;
            top:0;
            margin-left: -100px;
            background: white;
            padding-top: 20px;
            border:1px solid #4ec9dc;
            border-radius: 20px;
            z-index: 1000;
        }
        .delete h3{
            font-size: 15px;
            line-height: 30px;
            text-align: center;
        }
        .isNo{
            width: 100%;
        }
        .isNo a{
            width:40%;
            float: left;
            margin: 0 5%;
        }
        li span{
            cursor: pointer;
        }
        .bigImage{
            position: absolute;
            left: 0;
            top:0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 20000;
            background:#FFFFFF;
        }
        .bigImage img{
            max-width: 95%;
            height: auto;
            margin:2% 0 5% 2%;
        }
    </style>
</head>
<body>
<div class="page-content" style="min-height:650px">
    <div class="row">
        <div class="col-md-12">
            <div id="searchList" class="portlet box blue">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-list-alt"></i>查询结果
                    </div>
                    <div class="tools">
                        <a class="collapse" href="javascript:;" data-original-title="" title=""></a>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="JiLuShu" style="margin-bottom:8px">
                    </div>
                    <div class="table-scrollable">

                        <table class="table table-striped table-bordered table-advance table-hover">
                            <thead>
                            <tr>
                                <th width="10%">消息ID</th>
                                <th width="90%">消息标题</th>
                            </tr>
                            </thead>
                            <tbody id="tBody">
                            </tbody>
                            <tr>
                                <td colspan="11" align="center" class="text-align:center">
                                    <ul id="pagination" class="pagination center" style="">
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div id="modifyBox" class="modal fade in modifyClose " style="display: none; padding-right: 17px;">
                <div class="modal-dialog" style="width: 800px;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close"></button>
                            <h4 class="modal-title">修改课件</h4>
                        </div>
                        <div class="modal-body">
                            <div class="page-content">
                                <div class="row">
                                    <div class="col-md-12">
                                        <form class="form-horizontal" id="myForm" method="" action="">
                                            <div class="portlet box blue">
                                                <div class="portlet-title">
                                                    <div class="caption">
                                                        <i class="fa fa-pencil-square-o"></i>修改章节
                                                    </div>
                                                    <div class="tools">
                                                        <a class="collapse" href="javascript:;" data-original-title=""
                                                           title=""> </a>
                                                    </div>
                                                </div>
                                                <div class="portlet-body" style="display: block;">
                                                    <div class="form-body">
                                                        <!--课件代码-->
                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">课件代码
                                                                <span class="required"> * </span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-icon right">
                                                                    <i class="fa"></i>
                                                                    <select class="form-control" id="kjm" name="kjm">
                                                                    </select>
                                                                </div>
                                                                <span class="errorMessage"></span>
                                                            </div>
                                                        </div>
                                                        <!--父章节代码-->
                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">
                                                                父章节代码<span class="required"> * </span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-icon right">
                                                                    <i class="fa"></i>
                                                                    <select class="form-control" id="fzjdm"
                                                                            name="fzjdm">
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <span class="errorMessage"></span>
                                                        </div>
                                                        <!--章节代码-->
                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">章节代码
                                                                <span class="required"> * </span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-icon right">
                                                                    <i class="fa"></i>
                                                                    <input name="zjdm" id="zjm" type="text"
                                                                           maxlength="30" class="form-control">
                                                                </div>
                                                            </div>
                                                            <span class="errorMessage"></span>
                                                        </div>
                                                        <!--章节名称-->
                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">章节名称
                                                                <span class="required"> * </span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-icon right">
                                                                    <i class="fa"></i>
                                                                    <input name="zjmc" id="zjc" type="text"
                                                                           maxlength="50" class="form-control">
                                                                </div>
                                                            </div>
                                                            <span class="errorMessage"></span>
                                                        </div>
                                                        <!--章节序号-->
                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">章节序号
                                                                <span class="required"> * </span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-icon right">
                                                                    <i class="fa"></i>
                                                                    <input name="zjxh" id="zjxh" type="number"
                                                                           maxlength="50" class="form-control">
                                                                </div>
                                                            </div>
                                                            <span class="errorMessage"></span>
                                                        </div>
                                                        <!--课件时长-->
                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">课件时长
                                                                <span class="required"> * </span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-icon right">
                                                                    <i class="fa"></i>
                                                                    <input name="kjsc" id="kjsc" type="number"
                                                                           class="form-control">
                                                                </div>
                                                            </div>
                                                            <span class="errorMessage"></span>
                                                        </div>
                                                        <!--课件地址-->
                                                        <div class="form-group">
                                                            <label class="control-label col-sm-2">课件地址
                                                                <span class="required"> * </span>
                                                            </label>
                                                            <div class="col-sm-8">
                                                                <div class="input-icon right">
                                                                    <i class="fa"></i>
                                                                    <input name="kjdz" type="text" maxlength="200"
                                                                           id="kjdz" class="form-control">
                                                                </div>
                                                            </div>
                                                            <span class="errorMessage"></span>
                                                        </div>
                                                    </div>
                                                    <div class="form-actions">
                                                        <div class="row">
                                                            <div class="col-sm-offset-2 col-sm-9">
                                                                <input type="submit" name="" value="修改"
                                                                       id="submit" class="btn blue">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 
</div>
<!--[if lt IE 9]>
<script src="/js/es5-shim.js"></script>
<script src="/js/es5-sham.js"></script>
<script src="/metronic/assets/global/plugins/respond.js"></script>
<script src="/metronic/assets/global/plugins/excanvas.js"></script>
<![endif]-->
<script src="/metronic/assets/global/plugins/jquery.js"></script>
<script src="/metronic/assets/global/plugins/bootstrap/js/bootstrap.js"></script>
<script src="/metronic/assets/global/scripts/app.js"></script>
<script src="/js/jquery.validate.js"></script>
<script src="/js/jquery.form.js"></script>
<script src="/js/bioadanyanz.js"></script>
<script src="/js/height.js"></script>
<script src="/js/zhangjie.js"></script>
<script src="/js/topage.js"></script>
<script src="./assets/global/plugins/jquery.blockui.min.js"></script>
<script src="/js/loading.js"></script>
<script>
    var searchData = {
        myts:10,
        dqym:1
    };

    var n=0,JiLuShu,yeMeiShu,id;

    toAjax();

    function toModify() {
        $('.toModify').bind('click',function () {
            console.log($(this));
            id = $(this).attr('zjid');
            $('#modifyBox').show();
            getKjList(id, function () {
                $.ajax({
                    url: "/oneZhangJie",
                    type: 'get',
                    data:{zjid:id},
                    success: function (data) {
                        responseState(data, tianChong);
                        biaoDanYanZ('#myForm',"/updateZhangJie?zjid=" + id)
                    }
                })
            });
            return false
        });
    }

    function toAjax() {
        $.ajax({
            url:'/MessageList',
            type:'POST',
            dataType:'json',
            data:searchData,
            success:function (data) {
                if(data.ZhiXingZhuangTai<0&&data.ZhiXingZhuangTai!=-105){alert('获取消息失败');return}
                if(data.ZhiXingZhuangTai==-105){alert('登录超时'); window.location ='/';return}
                var allCount = data.JiLuShu;
                $('#xiaoXi').html(allCount);
                $('#WxiaoXi').html(allCount);
                JiLuShu = parseInt(data.JiLuShu);
                yeMeiShu = Math.ceil(JiLuShu / searchData.myts);
                searchStr(data);
                initPage();
                toModify();
            }
        })
    }

    function searchStr(data) {
        var str1 = '',
            str2 = '',
            str3 = '',
            str4 = '';

        $(data.ShuJu).each(function (index, item) {
            n +=1;
            str1 += '<tr>'
                + '<td>'+n+'</td>'
                + '<td><span zjid="'+item.ZhangJieID+'" class="toModify" title="'+item.KeChengMing+'-'+item.ZhangJieMing+',没有添加课件'+'" style="cursor: pointer">'+item.KeChengDaiMa+'-'+item.ZhangJieMing+',没有添加课件'+'</span></td>'
                + '</tr>';
        });

        $('#tBody').html(str1);

        str2 += '<div>共条' + JiLuShu + '记录</div>';

        $('.JiLuShu').html(str2);

        if (yeMeiShu <= 7) {
            for (var i = 1; i <= yeMeiShu; i++) {
                str3 += '<li><span>' + i + '</span></li>'
            }
        } else {
            if (searchData.dqym <= 3) {
                for (var i = 1; i <= 6; i++) {
                    str3 += '<li><span>' + i + '</span></li>'
                }
                str3 += '<li class="disabled"><span>...</span></li>'
            }
            if (searchData.dqym > 3 && searchData.dqym < yeMeiShu - 2) {
                str3 += '<li class="disabled"><span>...</span></li>';
                for (var i = searchData.dqym - 2; i <= searchData.dqym + 2; i++) {
                    str3 += '<li><span>' + i + '</span></li>'
                }
                str3 += '<li class="disabled"><span>...</span></li>'
            }
            if (searchData.dqym > 3 &&searchData.dqym >= yeMeiShu - 2) {
                str3 += '<li class="disabled"><span>...</span></li>';
                for (var i = yeMeiShu - 6; i <= yeMeiShu; i++) {
                    str3 += '<li><span>' + i + '</span></li>'
                }
            }
        }
        str4 = ' <li id="first"><span>&lt;&lt;</span></li><li id="pre"><span >&lt;</span></li>'
            + str3
            + '<li id="next"><span>&gt;</span></li> <li id="last"><span>&gt;&gt;</span></li>';

        $('#pagination').html(str4);

        toHeight();

        str1 = str2 = str3 = str4 = null;
    }

    // 修改表单填充
    function tianChong(data) {
        $('#kjm').find('option').each(function (index, item) {
            $(item).html() == data.ShuJu[0].KeChengDaiMa ? $(item).prop('selected', true) : null;
        });
        firstZjList(data.ShuJu[0].KeChengDaiMa, data.ShuJu[0].FuZhangJieDaiMa);
        $('#zjm').val(data.ShuJu[0].ZhangJieDaiMa);
        $('#zjc').val(data.ShuJu[0].ZhangJieMing);
        $('#zjxh').val(data.ShuJu[0].ZhangJieXuHao);
        $('#kjsc').val(data.ShuJu[0].KeJianShiChang);
        $('#kjdz').val(data.ShuJu[0].KeJianDiZhi);
    }
</script>
</body>
</html>
