<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="./metronic/assets/global/plugins/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <link href="./metronic/assets/global/plugins/bootstrap/css/bootstrap.css" rel="stylesheet"/>
    <link href="./metronic/assets/global/css/components.css" rel="stylesheet"/>
    <style>
        .errorMessage{
            color: #FF0000;
        }
        .deleteAll{
             position: absolute;
             left: 0;
             top: 0;
             width: 100%;
             height: 100%;
             background: rgba(211, 211, 211, 0.42);
             display: none;
         }
        .delete{
            width: 200px;
            height:150px;
            position: relative;
            left: 50%;
            top:0;
            margin-left: -100px;
            background: white;
            padding-top: 20px;
            border:1px solid #4ec9dc;
            border-radius: 20px;
            z-index: 1000;
        }
        .delete h3{
            font-size: 15px;
            line-height: 30px;
            text-align: center;
        }
        .isNo{
            width: 100%;
        }
        .isNo a{
            width:40%;
            float: left;
            margin: 0 5%;
        }
        li span{
            cursor: pointer;
        }
        .bigImage{
            position: absolute;
            left: 0;
            top:0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 20000;
            background:#FFFFFF;
        }
        .bigImage img{
            max-width: 95%;
            height: auto;
            margin:2% 0 5% 2%;
        }
    </style>
</head>
<body>
<div class="page-content" style="min-height:650px">

    <h3 class="page-title"> 查询课件 </h3>

    <div class="row">
        <div class="col-md-12">
            <div class="portlet box blue">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-search"></i>查询条件
                    </div>
                    <div class="tools">
                        <a class="collapse" href="javascript:;" data-original-title="" title=""> </a>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <tbody>
                            <tr>
                                <td width="10%" align="right">课件代码</td>
                                <td width="23%">
                                    <input name="kjdm" type="text" id="kjdm" class="form-control">
                                </td>
                                <td width="10%" align="right">课件名称</td>
                                <td width="23%">
                                    <input name="kjmc" type="text" id="kjmc" class="form-control">
                                </td>
                                <td width="10%" align="right">主讲教师</td>
                                <td width="23%">
                                    <input name="zjjs" type="text" id="zjjs" class="form-control">
                                </td>
                            </tr>
                            <tr>
                                <td colspan="6" align="center">
                                    <input type="submit" value="查询" id="chaBtn" class="btn blue">
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="searchList" class="portlet box blue display-hide">

                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-list-alt"></i>查询结果
                    </div>
                    <div class="tools">
                        <a class="collapse" href="javascript:;" data-original-title="" title=""></a>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="JiLuShu" style="margin-bottom:8px">
                    </div>
                    <div class="table-scrollable">

                        <table class="table table-striped table-bordered table-advance table-hover">
                            <thead>
                            <tr>
                                <th width="10%">课件代码</th>
                                <th width="10%">课件名称</th>
                                <th width="10%">主讲教师</th>
                                <th width="10%">课件总时长</th>
                                <th width="10%">顺序播放</th>
                                <th width="10%">允许拖动播放</th>
                                <th width="10%">自动播放</th>
                                <th width="10%">自动加载</th>
                                <th>预览</th>
                                <th>操作</th>
                                <th>删除</th>
                            </tr>
                            </thead>
                            <tbody id="tBody">
                            </tbody>
                            <tr>
                                <td colspan="11" align="center" class="text-align:center">
                                    <ul id="pagination" class="pagination center" style="">
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="modifyBox" class="modal fade in " style="display: none; padding-right: 17px;">
        <div class="modal-dialog" style="width: 800px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close modifyClose"></button>
                    <h4 class="modal-title">修改课件</h4>
                </div>
                <div class="modal-body">
                    <div class="page-content" style="min-height:650px">
                        <div class="row">
                            <div class="col-md-12">
                                <form class="form-horizontal" id="myForm">
                                    <div class="portlet box blue">
                                        <div class="portlet-title">
                                            <div class="caption">
                                                <i class="fa fa-pencil-square-o"></i>修改课件
                                            </div>
                                            <div class="tools">
                                                <a class="collapse" href="javascript:;" data-original-title=""
                                                   title=""> </a>
                                            </div>
                                        </div>
                                        <div class="portlet-body" style="display: block;">
                                            <div class="form-body">
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">课件代码
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <input name="kjdm" type="text" maxlength="30"
                                                                 id="kjd" readonly="readonly" class="form-control">
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">课程名称
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <input name="kjmc" type="text" maxlength="50" class="form-control" id="kjm">
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">课件总时长
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <input name="kjsc" type="number" maxlength="50"
                                                                   class="form-control" id="kjzsc">
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">主讲师
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <input name="zjjs" type="text" maxlength="30"
                                                                   class="form-control" id="js">
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">课程图片
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div>
                                                            <img id="tx" src="" title="点击图片，放大！！！！" alt="课件图片" style="height: 120px">
                                                        </div>
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <input type="file" name="kjtp" id="kjtp"
                                                                   class="form-control" enctype="multipart/form-data" id="kjtu">
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">课件URL域名
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <input name="kjlj" type="text" maxlength="200"
                                                                   id="kjur" class="form-control">
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">顺序学习
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="radio col-sm-8" id="sxxx">
                                                        <label>
                                                            <input type="radio" name="sxxx" value="1" >是
                                                        </label>
                                                        <label>
                                                            <input type="radio" name="sxxx" value="0"> 否
                                                        </label>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">允许拖动播放
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="radio col-sm-8" id="yxtd">
                                                        <label>
                                                            <input type="radio" name="yxtd" value="1" >是
                                                        </label>
                                                        <label>
                                                            <input type="radio" name="yxtd" value="0"> 否
                                                        </label>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">自动播放
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="radio col-sm-8" id="zdbf">
                                                        <label>
                                                            <input type="radio" name="zdbf" value="1" checked>是
                                                        </label>
                                                        <label>
                                                            <input type="radio" name="zdbf" value="0"> 否
                                                        </label>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">自动加载下一章
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="radio col-sm-8" id="zdjzxyz">
                                                        <label>
                                                            <input type="radio" name="zdjzxyz" value="1" checked>是
                                                        </label>
                                                        <label>
                                                            <input type="radio" name="zdjzxyz" value="0"> 否
                                                        </label>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">排序
                                                        <span class="required"> * </span>
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <input name="px" type="number" maxlength="3"
                                                                   id="px" class="form-control" value="999">
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                                <div class="form-group">
                                                    <label class="control-label col-sm-2">课件简介
                                                    </label>
                                                    <div class="col-sm-8">
                                                        <div class="input-icon right">
                                                            <i class="fa"></i>
                                                            <textarea name="kjjj" rows="6" cols="20"
                                                                      id="kjjj" class="form-control"></textarea>
                                                        </div>
                                                    </div>
                                                    <span class="errorMessage"></span>
                                                </div>
                                            </div>
                                            <div class="form-actions">
                                                <div class="row">
                                                    <div class="col-sm-offset-2 col-sm-9">
                                                        <input type="submit" value="提交" id="submit" class="btn blue">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="bigImage">
    <img src="" alt="课件封面图片" title="点击图片，返回！！" id="bigImage">
</div>
<div class="deleteAll">
    <div class="delete" id="tanchu">
        <h3>确定删除吗？</h3>
        <div class="isNo">
            <a class="btn btn-sm btn-success" isNo="Yes">
                <i class="glyphicon glyphicon-ok"></i> Yes</a>
            <a class="btn btn-sm btn-danger" isNo="No">
                <i class="glyphicon glyphicon-remove"></i> No</a>
        </div>
    </div>
</div>
<!--[if lt IE 9]>
<script src="/js/es5-shim.js"></script>
<script src="/js/es5-sham.js"></script>
<script src="/metronic/assets/global/plugins/respond.js"></script>
<script src="/metronic/assets/global/plugins/excanvas.js"></script>
<![endif]-->
<script src="/metronic/assets/global/plugins/jquery.js"></script>
<script src="./assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
<script src="/metronic/assets/global/plugins/bootstrap/js/bootstrap.js"></script>
<script src="/metronic/assets/global/scripts/app.js"></script>
<script src="/js/jquery.validate.js"></script>
<script src="/js/jquery.form.js"></script>
<script src="/js/height.js"></script>
<script src="/js/bioadanyanz.js"></script>
<script src="/js/topage.js"></script>
<script src="/js/md5.min.js"></script>
<script src="./assets/global/plugins/jquery.blockui.min.js"></script>
<script src="/js/loading.js"></script>
<script>
    var searchData = {kjdm: null, kjmc: null, kjjs: null, dqym: null, myts: 10},
        JiLuShu = null,
        yeMeiShu = null,
        id = null,
        deleteId = null;
    //查询
    $('#chaBtn').bind('click',function () {
        searchData = {
            kjdm: $('#kjdm').val(),
            kjmc: $('#kjmc').val(),
            zjjs: $('#zjjs').val(),
            dqym: 1,
            myts: 10
        };
        toAJax();
        return false
    });

    //修改课件中的查看课件图片
    $('#tx').bind('click',function () {
        if(!$('#tx').attr('src'))return;
        $('.bigImage').show();
        return false
    });
    $('.bigImage img').bind('click',function () {
        $('.bigImage').hide();
        return false
    });

    //删除
    $('#tanchu a').bind('click',function (e) {
        var e =e || window.event;
        target = e.target || e.srcElement;
        if($(target).attr('isNo')=='Yes'||$(target).hasClass('glyphicon-ok')){
            $.ajax({
                url: '/deleteKeJian',
                type: 'get',
                data: {kjdm:deleteId},
                success: function (data) {
                    $('.deleteAll').hide();
                    responseState(data,function () {
                        alert(data.ZhiXingJieGuo);
                        toAJax()
                    })
                }
            })
        }
        if($(target).attr('isNo')=='No'||$(target).hasClass('glyphicon-remove')){
            $('.deleteAll').hide();
        }
        return false
    });


    modifyDelete()

    //删除 修改 预览
    function modifyDelete() {
        $('#tBody').bind('click',function (e) {
            var e = e || window.event;
            var target = e.target || e.srcElement;
            console.log(target)
//            删除
            if ($(target).attr('id') == 'delete'||$(target).hasClass('fa-trash-o')) {
                deleteId = $(target).attr('kjdm');
                $('.deleteAll').show();
               $('.delete').css('top',e.clientY - 130 +'px')
               return false
            }
//            修改
            if ($(target).attr('id') == 'modify'||$(target).hasClass('fa-edit')) {
                id = $(target).attr('kjdm');
                $('#modifyBox').show();
                $.ajax({
                    url: "/oneKeJian",
                    type: 'get',
                    data:{kjdm:id} ,
                    success: function (data) {
                        tianChong(data.ShuJu[0]);
                        ckTianChong({
                            "#sxxx input":data.ShuJu[0].IsShunXuXueXi,
                            "#yxtd input":data.ShuJu[0].IsYunXuTuoDong,
                            "#zdbf input":data.ShuJu[0].IsZiDongBoFang,
                            "#zdjzxyz input":data.ShuJu[0].IsZiDongJiaZaiXiaYiZhang
                        });
                        //表单验证
                        biaoDanYanZ("#myForm","/upDataKeJian");
                    }
                })
                return false
            }
//            预览
            if ($(target).attr('id') == 'view'||$(target).hasClass('fa-link')) {
                var obj={
                    xt:Cookies.getJSON().xtid.toString(),
                    kcdm:$(target).attr('kjdm'),
                    zjdm:'',
                    bfwz:'',
                    yhbs:Cookies.getJSON().yhm,
                    yhxm:encodeURI(Cookies.getJSON().yhxm),
                    jklx:0,
                    sjc:getTime(),
                };
                $.ajax({
                    url:'/XiTong',
                    dataType:'json',
                    success:function (data) {
                        var my = data.MiYao;
                        window.open(urlstr(obj,my))
                    }
                })
                return false
            }
            
        });
    }

    //    模板拼接
    function searchStr(data) {
        var str1 = '',
            str2 = '',
            str3 = '',
            str4 = '';

        $(data.ShuJu).each(function (index, item) {
            var IsShunXuXueXi = isNo(item.IsShunXuXueXi),
                IsYunXuTuoDong = isNo(item.IsYunXuTuoDong),
                IsZiDongBoFang = isNo(item.IsZiDongBoFang),
                IsZiDongJiaZaiXiaYiZhang = isNo(item.IsZiDongJiaZaiXiaYiZhang);

            str1 += '<tr>'
                + '<td>' + item.KeChengDaiMa + '</td>'
                + '<td>' + item.KeChengMing + '</td>'
                + '<td>' + item.ZhuJiangJiaoShi + '</td>'
                + '<td>' + item.ZongShiChang + '</td>'
                + '<td>' + IsShunXuXueXi + '</td>'
                + '<td>' + IsYunXuTuoDong + '</td>'
                + '<td>' + IsZiDongBoFang + '</td>'
                + '<td>' + IsZiDongJiaZaiXiaYiZhang + '</td>'
                + '<td>'
                + '<a href="#" title="修改课件" class="btn btn-outline btn-sm blue" id="view" kjdm="' + item.KeChengDaiMa + '">'
                + '<i class="fa fa-link"  kjdm="' + item.KeChengDaiMa + '"></i>预览 </a>'
                + '</td>'
                + '<td>'
                + '<a href="#" title="修改课件" class="btn btn-outline btn-sm blue" id="modify" kjdm="' + item.KeChengDaiMa + '">'
                + '<i class="fa fa-edit"  kjdm="' + item.KeChengDaiMa + '"></i>修改 </a>'
                + '</td>'
                + '<td>'
                + '<a href="#" title="删除资料" class="btn btn-outline btn-sm blue" id="delete" kjdm="' + item.KeChengDaiMa + '">'
                + '<i class="fa fa-trash-o"  kjdm="' + item.KeChengDaiMa + '"></i>删除</a>'
                + '</td>'
                + '</tr>';
        });

        $('#tBody').html(str1);

        str2 += '<div>共条' + JiLuShu + '记录</div>';

        $('.JiLuShu').html(str2);

        if(yeMeiShu<=7){
            for (var i = 1; i <= yeMeiShu; i++) {
                str3 += '<li><span>' + i + '</span></li>'
            }
        }else{
            if(searchData.dqym<=3){
                for (var i = 1; i <= 6; i++) {
                    str3 += '<li><span>' + i + '</span></li>'
                }
                str3 += '<li class="disabled"><span>...</span></li>'
            }
            if(searchData.dqym>3&&searchData.dqym<yeMeiShu-2){
                str3 += '<li class="disabled"><span>...</span></li>';
                for (var i = searchData.dqym-2; i <= searchData.dqym+2; i++) {
                    str3 += '<li><span>' + i + '</span></li>'
                }
                str3 += '<li class="disabled"><span>...</span></li>'
            }
            if(searchData.dqym>3&&searchData.dqym >= yeMeiShu - 2){
                str3 += '<li class="disabled"><span>...</span></li>';
                for (var i = yeMeiShu-6; i <= yeMeiShu; i++) {
                    str3 += '<li><span>' + i + '</span></li>'
                }
            }
        }

        str4 = ' <li id="first"><span>&lt;&lt;</span></li><li id="pre"><span>&lt;</span></li>'
            + str3
            + '<li id="next"><span>&gt;</span></li> <li id="last"><span>&gt;&gt;</span></li>';

        $('#pagination').html(str4);

         toHeight();

        str1 = str2 = str3 = str4 = null;

        stop()
    }

    //    页面调转ajax
    function toAJax() {
        $.ajax({
            url: "/searchKeJian",
            type: "post",
            dataType: "json",
            data: searchData,
            success: function (data) {
                responseState(data,function () {
                    JiLuShu = parseInt(data.JiLuShu);
                    yeMeiShu = Math.ceil(JiLuShu / searchData.myts);
                    $('#searchList').show();
                    searchStr(data);
                    initPage();
                })
            }
        })
    }

    //    是否-01判断
    function isNo(str) {
        str = parseInt(str) == 1 ? "是" : "否";
        return str
    }

    // 修改表单填充
    function tianChong(data){
        $('#kjd').val(data.KeChengDaiMa);
        $('#kjm').val(data.KeChengMing);
        $('#kjzsc').val(data.ZongShiChang);
        $('#js').val(data.ZhuJiangJiaoShi);
        $('#kjur').val(data.KeChengLuJing);
        $('#px').val(data.PaiXu);
        $('#kjjj').val(data.KeChengJianJie);
        $('#tx').attr('src',data.KeChengTuPianLuJing)
        $('#bigImage').attr('src',data.KeChengTuPianLuJing)
    }

    //checked表单填充
    function ckTianChong(opation) {
        for(var a in opation){
            $(a).each(function (index,item) {
                if($(item).val()==opation[a]){
                    item.checked = 'checked'
                }
            })
        }
    }

    //time
    function getTime() {
        var time = new Date(),
            str = '';
        timeObj = {
            y:time.getFullYear().toString(),
            m:(time.getMonth()+1).toString(),
            d:time.getDate().toString(),
            h:time.getHours().toString(),
            f:time.getMinutes().toString(),
            s:time.getSeconds().toString()
        };
        for(var a in timeObj){
                str+=timeObj[a]
        }
        return str
    }

    //urlstr
    function urlstr(obj,my) {
        var urlStr ='http://192.168.100.6:8018/KeCheng/JieKou?', jyc =my,ary=[],str='';
        for(var a in obj){
                jyc +=obj[a];
                ary.push(a+'='+obj[a])
        };
        urlStr +=ary.join('&')+'&jyc='+encodeURI(md5(jyc));
        return urlStr
    }
</script>
</body>
</html>
